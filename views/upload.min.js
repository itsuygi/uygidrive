let fileList,nextPage,prePage,searchBox,pageNumber,createFolderButton,createFolderName,pathDisplay,currentPage=1,sort="date:new-first",firstLoad=!0,path="/";function loadList(){fileList.innerHTML='\n      <div>\n        <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>\n        <br>\n        \x3c!--<h5>Loading...</h5>--\x3e\n      </div>\n    ';const e=searchBox.value,n=new XMLHttpRequest;let t="/list?page="+currentPage;console.log(e),e&&(t=t+"&search="+e),sort&&(t=t+"&sort="+sort),path&&"/"!=path&&(t=t+"&path="+path),n.open("GET",t,!0),pageNumber.innerHTML=currentPage,n.onload=function(){if(200===n.status){const{files:e,next:t}=JSON.parse(n.responseText);nextPage.style.display=0==t?"none":"inline",fileList.innerHTML="",e.forEach(e=>{let n;e.url&&(n=e.url);let t="file"==e.type?`openPreview('${e.url}')`:`openDirectory('${e.path}')`,o="file"==e.type?`<a class="dropdown-item" onclick="downloadFile('${e.url}')">\n                    <i class="fa-solid fa-download"></i>\n                    Download\n                  </a>\n\n                  <a class="dropdown-item" onclick="shareFile('${e.path}')">\n                    <i class="fa-solid fa-share"></i>\n                    Share\n                  </a>\n\n                  <div class="dropdown-divider"></div>\n\n                  <a class="dropdown-item" onclick="deleteFile('${e.path}')">\n                    <i class="fa-solid fa-trash"></i>\n                    Delete\n                  </a>`:`<a class="dropdown-item" onclick="deleteFile('${e.path}')">\n                <i class="fa-solid fa-trash"></i>\n                Delete\n               </a>`,l=`\n          <div class="file-card $light">\n            ${"file"==e.type?'<i class="fa-solid fa-file"></i>':'<i class="fa-regular fa-folder"></i>'}\n          \n            <div class="file-actions" >\n              <li class="fas fa-ellipsis-v" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ></li>\n              <div class="dropdown-menu" >\n                \x3c!-- Dropdown menu links --\x3e\n                \n                \x3c!--<h6 class="dropdown-header">File actions</h6>--\x3e\n                \n                ${o}\n                \n              </div>\n            </div>\n            \n            <div onclick="${t}">\n              <h5 class="file-name">${e.name}</h5>\n              <p>${e.size}</p>\n            </div>\n          </div>\n        `;fileList.insertAdjacentHTML("beforeend",l)}),firstLoad=!1}else fileList.innerHTML="Error: "+n.responseText},n.send()}function logout(){window.location.replace("/sessionLogout")}function resizeIFrameToFitContent(e){e.width=e.contentWindow.document.body.scrollWidth,e.height=e.contentWindow.document.body.scrollHeight}function openPreview(e){const n=getTagByFileExtension(e);if(console.log(n),n){n.style.display="block",n.src=e;let t=e.split("/");document.getElementById("previewModalLabel").innerHTML=t[t.length-1],$("#previewModal").modal()}else downloadFile(e)}function openDirectory(e){path=e,searchBox.value="",currentPage=1,pathDisplay.innerHTML="",pathDisplay.innerHTML='<a href="#" onclick="openDirectory(\'/\')">Your Files</a>';let n=e.split("/");console.log(n),n.forEach(e=>{if(""!=e){let n=`<a> > </a> <a  onclick="openDirectory('${e+"/"}')">${e}</a>`;pathDisplay.insertAdjacentHTML("beforeend",n)}}),loadList()}function shareFile(e){const n=new XMLHttpRequest;n.open("POST","/getShareLink",!0),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){console.log(n.responseText),openShareModal(n.responseText)},console.log(JSON.stringify({file:e})),n.send(JSON.stringify({file:e}))}function openShareModal(e){document.getElementById("urlInput").value=e,$("#shareModal").modal()}function deleteFile(e){if(confirm("Are you sure to delete this file?")){const n=new XMLHttpRequest;n.open("DELETE","/file/"+e,!0),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){console.log(n.responseText),loadList()},n.send()}}function createFolder(e){const n=new XMLHttpRequest;n.open("PUT","/folder?path="+("/"==path?"":path),!0),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){console.log(n.responseText),$("#folderModal").modal("hide"),createFolderButton.innerHTML="Create folder",createFolderButton.disabled=!1,loadList()},createFolderButton.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n  <span class="sr-only">Loading...</span>',createFolderButton.disabled=!0,n.send(JSON.stringify({name:e}))}function changeSort(e){sort=e,loadList()}function downloadFile(e){document.getElementById("download_iframe").src=e+"?download=true"}function getTagByFileExtension(e){const n=e.split(".").pop();console.log(n);const t={mp3:"audioPreview",wav:"audioPreview",ogg:"audioPreview",mp4:"videoPreview",mov:"videoPreview",webm:"videoPreview",png:"filePreview",jpg:"filePreview",jpeg:"filePreview",gif:"filePreview",pdf:"filePreview",doc:"filePreview",py:"filePreview",c:"filePreview",json:"filePreview",js:"filePreview",css:"filePreview",html:"filePreview",txt:"filePreview"}[n.toLowerCase()];return console.log(t),document.getElementById(t)}function closeModal(e){$("#"+e).modal("hide")}window.onload=function(){const e=document.getElementById("uploadForm"),n=(document.getElementById("uploadButton"),document.getElementById("fileInput")),t=document.getElementById("successBox"),o=(document.getElementById("fileURL"),document.getElementById("errorBox")),l=document.getElementById("errorMessage"),a=document.getElementById("search"),i=(document.getElementById("sortSelect"),document.getElementById("copyShareLink"));fileList=document.getElementById("fileList"),nextPage=document.getElementById("nextPage"),prePage=document.getElementById("previousPage"),searchBox=document.getElementById("searchBox"),pageNumber=document.getElementById("pageNumber"),pathDisplay=document.getElementById("pathDisplay"),createFolderButton=document.getElementById("createFolderButton"),createFolderName=document.getElementById("createFolderName");document.getElementsByClassName("previewEmbed");let s=document.getElementById("urlInput");firebase.initializeApp({apiKey:"AIzaSyCILjXwpyNilznxbFTWC9J2Ys2JdJTX0vg",authDomain:"uygidrive.firebaseapp.com",projectId:"uygidrive",storageBucket:"uygidrive.appspot.com",messagingSenderId:"210147915736",appId:"1:210147915736:web:9e3548e815091d7512a4ad",measurementId:"G-GB12PYXWF7"}),e.addEventListener("submit",function(a){a.preventDefault();let i=n.files,s=[];for(let n=0;n<i.length;n++){let a=i[n];const d=new FormData;d.append("file",a);const r=new XMLHttpRequest;r.open("POST","/upload?path="+("/"==path?"":path),!0),e.style.display="none";let c=document.createElement("div");c.classList.add("progress-container");let p=document.createElement("span");p.innerHTML=a.name,p.classList.add("file-name"),c.appendChild(p);let u=document.createElement("progress");u.value=0,u.max=100,u.classList.add("file-progress"),c.appendChild(u);let m=document.createElement("span");m.innerHTML="0%",m.classList.add("progress-text"),c.appendChild(m),document.getElementById("uploadContainer").appendChild(c),r.upload.onprogress=function(e){if(e.lengthComputable){const n=Math.floor(e.loaded/e.total*100);u.value=n,m.textContent=n+"%"}},r.onload=function(){if(200===r.status){var e=r.responseText;if(s.push(e),c.remove(),s.length==i.length){document.getElementsByClassName("progress-container");t.style.display="block";let e=document.getElementById("urlList");for(let n=0;n<s.length;n++){let t=document.createElement("li"),o=document.createElement("a");o.style="color: CornflowerBlue",o.target="_blank",o.href=s[n],o.innerText=s[n],t.appendChild(o),e.appendChild(t)}}loadList()}else c.remove(),l.innerHTML=r.responseText,o.style.display="block"},r.send(d)}}),i.onclick=function(){s.select(),document.execCommand("copy"),i.innerHTML='<i class="fa-solid fa-check"></i>',setTimeout(function(){i.innerHTML="Copy Link"},2e3)},a.addEventListener("submit",function(e){e.preventDefault(),loadList()}),loadList(),nextPage.addEventListener("click",function(){currentPage++,prePage.style.display="inline",loadList(),console.log("Loading next page")}),prePage.addEventListener("click",function(){currentPage-1>=1?(prePage.style.display="inline",currentPage--,loadList(),console.log("Loading previous page")):prePage.style.display="none"}),createFolderButton.addEventListener("click",function(){createFolder(createFolderName.value)}),$("#folderModal").on("hidden.bs.modal",function(e){createFolderName.value=""}),$("#uploadModal").on("hidden.bs.modal",function(e){const n=document.getElementById("successBox"),t=document.getElementById("errorBox"),o=document.getElementById("uploadForm"),l=document.getElementById("fileInput");n.style.display="none",t.style.display="none",o.style.display="block",l.value=null}),$("#previewModal").on("hidden.bs.modal",function(e){let n=document.getElementsByClassName("preview");for(let e=0;e<n.length;e++){let t=n[e];t.src="https://cdn.glitch.global/7fd03d08-8029-486c-9567-032d359a4c03/loading.gif?v=1705350315958",t.style.display="none"}console.log("File previews resetted.")})};